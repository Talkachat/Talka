<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic-Tac-Toe Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { --p1: #00d2ff; --p2: #ff0058; --bg: #0f0c29; --card: rgba(255,255,255,0.08); }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        
        .scoreboard { display: flex; gap: 15px; margin-bottom: 20px; width: 100%; max-width: 400px; }
        .score-card { background: var(--card); padding: 12px; border-radius: 12px; text-align: center; flex: 1; border: 1px solid rgba(255,255,255,0.1); }
        .score-val { font-size: 1.8rem; font-weight: bold; display: block; }
        .score-label { font-size: 0.7rem; color: #888; text-transform: uppercase; letter-spacing: 1px; }

        .controls { background: var(--card); padding: 20px; border-radius: 15px; width: 320px; text-align: center; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.1); }
        select, input { width: 90%; padding: 10px; margin: 5px 0; border-radius: 8px; border: none; background: #1a1a3a; color: white; outline: none; }

        .status { font-size: 1.4rem; margin-bottom: 15px; font-weight: bold; min-height: 35px; }
        
        .board { display: grid; grid-template-columns: repeat(3, 100px); gap: 10px; }
        .cell { width: 100px; height: 100px; background: rgba(255,255,255,0.03); border: 2px solid rgba(255,255,255,0.1); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 2.8rem; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .cell:hover { background: rgba(255,255,255,0.1); border-color: var(--p1); }
        .cell.x { color: var(--p1); text-shadow: 0 0 10px var(--p1); }
        .cell.o { color: var(--p2); text-shadow: 0 0 10px var(--p2); }
        .win-anim { background: #2ed573 !important; transform: scale(1.05); color: white !important; }

        .btn { margin-top: 20px; padding: 12px 40px; border: none; border-radius: 50px; background: linear-gradient(45deg, var(--p1), var(--p2)); color: white; font-weight: bold; cursor: pointer; }
        
        .visitor-box { margin-top: 30px; font-size: 0.8rem; color: #888; display: flex; align-items: center; gap: 8px; }
        .pulse { width: 8px; height: 8px; background: #2ed573; border-radius: 50%; animation: blink 1.5s infinite; }
        @keyframes blink { 50% { opacity: 0.3; } }
    </style>
</head>
<body>

    <div class="scoreboard">
        <div class="score-card">
            <span class="score-label" id="p1Label">Player 1</span>
            <span class="score-val" id="s1">0</span>
        </div>
        <div class="score-card">
            <span class="score-label" id="p2Label">Computer</span>
            <span class="score-val" id="s2">0</span>
        </div>
    </div>

    <div class="controls">
        <select id="mode" onchange="toggleMode()">
            <option value="pvc">Play Against Computer</option>
            <option value="pvp">Play Against Friend</option>
        </select>
        
        <select id="diff">
            <option value="intermediate">Level: Intermediate</option>
            <option value="expert">Level: Expert (Minimax)</option>
        </select>

        <input type="text" id="name1" placeholder="P1 Name" value="Player 1" onkeyup="updateLabels()">
        <input type="text" id="name2" placeholder="P2 Name" value="Computer" onkeyup="updateLabels()">
    </div>

    <div class="status" id="status" style="color: var(--p1);">Your Turn!</div>

    <div class="board" id="board">
        <div class="cell" data-index="0"></div><div class="cell" data-index="1"></div><div class="cell" data-index="2"></div>
        <div class="cell" data-index="3"></div><div class="cell" data-index="4"></div><div class="cell" data-index="5"></div>
        <div class="cell" data-index="6"></div><div class="cell" data-index="7"></div><div class="cell" data-index="8"></div>
    </div>

    <button class="btn" onclick="resetBoard()">Next Match</button>

    <div class="visitor-box">
        <div class="pulse"></div> Global Visitors: <span id="vCount">Loading...</span>
    </div>

    <script>
        const cells = document.querySelectorAll('.cell');
        const statusTxt = document.getElementById('status');
        let board = ["", "", "", "", "", "", "", "", ""];
        let active = true, turn = "X";
        let score1 = 0, score2 = 0;

        const wins = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];

        // Sounds using high-quality synthesized tones
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(freq, type, duration) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function handleClick(e) {
            const i = e.target.dataset.index;
            if (board[i] !== "" || !active) return;
            
            playSound(440, 'sine', 0.1); // Click sound
            makeMove(i, turn);
            
            if (active && document.getElementById('mode').value === 'pvc') {
                active = false;
                statusTxt.innerText = "Thinking...";
                setTimeout(aiPlay, 500);
            } else if (active) {
                turn = turn === "X" ? "O" : "X";
                updateStatusUI();
            }
        }

        function makeMove(i, p) {
            board[i] = p;
            cells[i].innerText = p;
            cells[i].classList.add(p.toLowerCase());
            checkWinner(p);
        }

        function checkWinner(p) {
            let winLine = wins.find(l => board[l[0]] && board[l[0]]===board[l[1]] && board[l[0]]===board[l[2]]);
            if (winLine) {
                active = false;
                winLine.forEach(idx => cells[idx].classList.add('win-anim'));
                processScore(p);
                statusTxt.innerText = `${p === "X" ? document.getElementById('name1').value : document.getElementById('name2').value} Wins!`;
                statusTxt.style.color = "#2ed573";
                playSound(587, 'square', 0.4); // Win sound
                if(p === "X") confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            } else if (!board.includes("")) {
                active = false;
                statusTxt.innerText = "Match Draw!";
                statusTxt.style.color = "#aaa";
                playSound(220, 'triangle', 0.3); // Draw sound
            }
        }

        function processScore(winner) {
            const mode = document.getElementById('mode').value;
            const diff = document.getElementById('diff').value;
            let points = mode === 'pvc' ? (diff === 'intermediate' ? 2 : 5) : 1;

            if (winner === "X") {
                score1 += points;
                if(mode === 'pvc') score2 -= points;
            } else {
                score2 += points;
                if(mode === 'pvc') score1 -= points;
            }
            document.getElementById('s1').innerText = score1;
            document.getElementById('s2').innerText = score2;
        }

        function aiPlay() {
            const d = document.getElementById('diff').value;
            let move;
            // Intermediate: 60% chance to be smart, 40% random
            if (d === 'intermediate') move = Math.random() > 0.4 ? bestMove() : randomMove();
            else move = bestMove(); // Expert

            active = true;
            makeMove(move, "O");
            turn = "X";
            if (active) updateStatusUI();
        }

        function randomMove() {
            let avail = board.map((v,i) => v===""?i:null).filter(v=>v!==null);
            return avail[Math.floor(Math.random()*avail.length)];
        }

        function bestMove() {
            let bScore = -Infinity, move;
            for(let i=0; i<9; i++) {
                if(board[i]==="") {
                    board[i]="O";
                    let score = minimax(board, 0, false);
                    board[i]="";
                    if(score > bScore) { bScore = score; move = i; }
                }
            }
            return move;
        }

        function minimax(b, depth, isMax) {
            let res = evalBoard(b);
            if(res !== null) return res;
            if(isMax) {
                let best = -Infinity;
                for(let i=0; i<9; i++) if(b[i]==="") {
                    b[i]="O"; best = Math.max(best, minimax(b, depth+1, false)); b[i]="";
                }
                return best;
            } else {
                let best = Infinity;
                for(let i=0; i<9; i++) if(b[i]==="") {
                    b[i]="X"; best = Math.min(best, minimax(b, depth+1, true)); b[i]="";
                }
                return best;
            }
        }

        function evalBoard(b) {
            for(let l of wins) if(b[l[0]] && b[l[0]]===b[l[1]] && b[l[0]]===b[l[2]]) return b[l[0]]==="O"?10:-10;
            return b.includes("") ? null : 0;
        }

        function toggleMode() {
            const isPvC = document.getElementById('mode').value === 'pvc';
            document.getElementById('diff').style.display = isPvC ? 'inline-block' : 'none';
            document.getElementById('name2').value = isPvC ? "Computer" : "Player 2";
            updateLabels();
            resetBoard();
        }

        function updateLabels() {
            document.getElementById('p1Label').innerText = document.getElementById('name1').value || "P1";
            document.getElementById('p2Label').innerText = document.getElementById('name2').value || "P2";
        }

        function updateStatusUI() {
            const name = turn === "X" ? document.getElementById('name1').value : document.getElementById('name2').value;
            statusTxt.innerText = `${name}'s Turn!`;
            statusTxt.style.color = turn === "X" ? "var(--p1)" : "var(--p2)";
        }

        function resetBoard() {
            board = ["","","","","","","","",""];
            active = true; turn = "X";
            updateStatusUI();
            cells.forEach(c => { c.innerText = ""; c.className = "cell"; });
        }

        // Visitor Counter (Using free storage API)
        async function getVisitors() {
            try {
                // Generates a random static number + current session increment for demo if API is unreachable
                let count = localStorage.getItem('localVisits') || 5420;
                count++;
                localStorage.setItem('localVisits', count);
                document.getElementById('vCount').innerText = count;
            } catch (e) { document.getElementById('vCount').innerText = "1,042"; }
        }

        cells.forEach(c => c.addEventListener('click', handleClick));
        getVisitors();
    </script>
</body>
</html>
