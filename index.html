<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic-Tac-Toe Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { --p1: #00d2ff; --p2: #ff0058; --bg: #0f0c29; --card: rgba(255,255,255,0.08); }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        
        .controls { background: var(--card); padding: 20px; border-radius: 15px; width: 320px; text-align: center; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.1); }
        select, input { width: 90%; padding: 10px; margin: 5px 0; border-radius: 8px; border: none; background: #1a1a3a; color: white; outline: none; }

        .status { font-size: 1.6rem; margin-bottom: 20px; font-weight: bold; min-height: 40px; text-align: center; }
        
        .board { display: grid; grid-template-columns: repeat(3, 100px); gap: 12px; }
        .cell { width: 100px; height: 100px; background: rgba(255,255,255,0.03); border: 2px solid rgba(255,255,255,0.1); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 3rem; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .cell:hover { background: rgba(255,255,255,0.1); border-color: var(--p1); }
        .cell.x { color: var(--p1); text-shadow: 0 0 10px var(--p1); }
        .cell.o { color: var(--p2); text-shadow: 0 0 10px var(--p2); }
        .win-anim { background: #2ed573 !important; transform: scale(1.05); color: white !important; }

        .btn { margin-top: 30px; padding: 12px 50px; border: none; border-radius: 50px; background: linear-gradient(45deg, var(--p1), var(--p2)); color: white; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn:hover { transform: scale(1.05); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        
        .visitor-box { margin-top: auto; padding-top: 40px; font-size: 0.8rem; color: #888; display: flex; align-items: center; gap: 8px; }
        .pulse { width: 8px; height: 8px; background: #2ed573; border-radius: 50%; animation: blink 1.5s infinite; }
        @keyframes blink { 50% { opacity: 0.3; } }
    </style>
</head>
<body>

    <div class="controls">
        <select id="mode" onchange="toggleMode()">
            <option value="pvc">Play Against Computer</option>
            <option value="pvp">Play Against Friend</option>
        </select>
        
        <select id="diff">
            <option value="intermediate">Level: Intermediate</option>
            <option value="expert">Level: Expert</option>
        </select>

        <input type="text" id="name1" placeholder="P1 Name" value="Player 1">
        <input type="text" id="name2" placeholder="P2 Name" value="Computer">
    </div>

    <div class="status" id="status" style="color: var(--p1);">Your Turn!</div>

    <div class="board" id="board">
        <div class="cell" data-index="0"></div><div class="cell" data-index="1"></div><div class="cell" data-index="2"></div>
        <div class="cell" data-index="3"></div><div class="cell" data-index="4"></div><div class="cell" data-index="5"></div>
        <div class="cell" data-index="6"></div><div class="cell" data-index="7"></div><div class="cell" data-index="8"></div>
    </div>

    <button class="btn" onclick="resetBoard()">Restart Match</button>

    <div class="visitor-box">
        <div class="pulse"></div> Global Visitors: <span id="vCount">Loading...</span>
    </div>

    <script>
        const cells = document.querySelectorAll('.cell');
        const statusTxt = document.getElementById('status');
        let board = ["", "", "", "", "", "", "", "", ""];
        let active = true, turn = "X";

        const wins = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];

        // Audio System
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(freq, type, duration) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function handleClick(e) {
            const i = e.target.dataset.index;
            if (board[i] !== "" || !active) return;
            
            playSound(440, 'sine', 0.1); 
            makeMove(i, turn);
            
            if (active && document.getElementById('mode').value === 'pvc') {
                active = false;
                statusTxt.innerText = "Computer Thinking...";
                setTimeout(aiPlay, 500);
            } else if (active) {
                turn = turn === "X" ? "O" : "X";
                updateStatusUI();
            }
        }

        function makeMove(i, p) {
            board[i] = p;
            cells[i].innerText = p;
            cells[i].classList.add(p.toLowerCase());
            checkWinner(p);
        }

        function checkWinner(p) {
            let winLine = wins.find(l => board[l[0]] && board[l[0]]===board[l[1]] && board[l[0]]===board[l[2]]);
            if (winLine) {
                active = false;
                winLine.forEach(idx => cells[idx].classList.add('win-anim'));
                statusTxt.innerText = `${p === "X" ? document.getElementById('name1').value : document.getElementById('name2').value} Wins!`;
                statusTxt.style.color = "#2ed573";
                playSound(587, 'square', 0.4); 
                if(p === "X") confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            } else if (!board.includes("")) {
                active = false;
                statusTxt.innerText = "Draw!";
                statusTxt.style.color = "#aaa";
                playSound(220, 'triangle', 0.3);
            }
        }

        function aiPlay() {
            const d = document.getElementById('diff').value;
            let move;
            if (d === 'intermediate') move = Math.random() > 0.4 ? bestMove() : randomMove();
            else move = bestMove();

            active = true;
            makeMove(move, "O");
            turn = "X";
            if (active) updateStatusUI();
        }

        function randomMove() {
            let avail = board.map((v,i) => v===""?i:null).filter(v=>v!==null);
            return avail[Math.floor(Math.random()*avail.length)];
        }

        function bestMove() {
            let bScore = -Infinity, move;
            for(let i=0; i<9; i++) {
                if(board[i]==="") {
                    board[i]="O";
                    let score = minimax(board, 0, false);
                    board[i]="";
                    if(score > bScore) { bScore = score; move = i; }
                }
            }
            return move;
        }

        function minimax(b, depth, isMax) {
            let res = evalBoard(b);
            if(res !== null) return res;
            if(isMax) {
                let best = -Infinity;
                for(let i=0; i<9; i++) if(b[i]==="") {
                    b[i]="O"; best = Math.max(best, minimax(b, depth+1, false)); b[i]="";
                }
                return best;
            } else {
                let best = Infinity;
                for(let i=0; i<9; i++) if(b[i]==="") {
                    b[i]="X"; best = Math.min(best, minimax(b, depth+1, true)); b[i]="";
                }
                return best;
            }
        }

        function evalBoard(b) {
            for(let l of wins) if(b[l[0]] && b[l[0]]===b[l[1]] && b[l[0]]===b[l[2]]) return b[l[0]]==="O"?10:-10;
            return b.includes("") ? null : 0;
        }

        function toggleMode() {
            const isPvC = document.getElementById('mode').value === 'pvc';
            document.getElementById('diff').style.display = isPvC ? 'inline-block' : 'none';
            document.getElementById('name2').value = isPvC ? "Computer" : "Player 2";
            resetBoard();
        }

        function updateStatusUI() {
            const name = turn === "X" ? document.getElementById('name1').value : document.getElementById('name2').value;
            statusTxt.innerText = `${name}'s Turn!`;
            statusTxt.style.color = turn === "X" ? "var(--p1)" : "var(--p2)";
        }

        function resetBoard() {
            board = ["","","","","","","","",""];
            active = true; turn = "X";
            updateStatusUI();
            cells.forEach(c => { c.innerText = ""; c.className = "cell"; });
        }

        async function getVisitors() {
            let count = localStorage.getItem('vStats') || 10452;
            count++;
            localStorage.setItem('vStats', count);
            document.getElementById('vCount').innerText = count.toLocaleString();
        }

        cells.forEach(c => c.addEventListener('click', handleClick));
        getVisitors();
    </script>
</body>
</html>
